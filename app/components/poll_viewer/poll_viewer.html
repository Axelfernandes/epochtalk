<div class="polls" ng-if="poll">
  <!-- Poll Header -->
  <div class="poll-header">
    <!-- Poll Details -->
    <div class="poll-controls">
      <!-- Poll Controls -->
      <div class="poll-control" ng-if="permissions.privilegedLock">
        <input id="lockPoll" class="icon" type="checkbox" ng-model="poll.locked">
        <label for="lockPoll" class="icon-epoch-lock" ng-click="updateLockPoll()">
        </label>
      </div>
      <div class="poll-control" ng-if="permissions.privilegedLock || (permissions.create && user.id === thread.user.id)">
        <input id="editPoll" class="icon" type="checkbox" ng-model="switches.editPoll">
        <label for="editPoll" class="icon-epoch-edit">
        </label>
      </div>
    </div>
    <div class="poll-details">
      <div class="poll-info" ng-if="poll.display_mode === 'always'">Results Always Shown</div>
      <div class="poll-info" ng-if="poll.display_mode === 'voted'">Results After Voting</div>
      <div class="poll-info" ng-if="poll.display_mode === 'expired'">Results After Expiration</div>
      <div class="poll-info">{{(poll.expiration|humanDate) || 'No Expiration'}}</div>
    </div>
    <div class="poll-details small">
      <div class="poll-info">{{poll.max_answers + ' choice(s)'}}</div>
      <div class="poll-info" ng-if="!poll.change_vote">Votes are Permanent</div>
      <div class="poll-info" ng-if="poll.change_vote">Votes can be changed</div>
    </div>

    <!-- Poll Question -->
    <h5 class="poll-question" ng-bind="poll.question"></h5>
  </div>

  <!-- Poll Edit -->
  <div class="poll-edit slide" ng-class="{ open: switches.editPoll }">
    <div class="poll-edit-container">
      <h5>Edit Poll Options:</h5>
      <input type="checkbox" id="pollVote" ng-model="options.change_vote">
      <label for="pollVote">Allow user to change vote</label>
      <label for="pollMaxVote">Poll expires at -- {{(options.expiration|humanDate) || 'No Expiration'}}</label>
      <div class="fill-row">
        <div class="half-column">
          <input type="date" ng-model="options.expiration_date" ng-change="calcExpiration()">
        </div>
        <div class="half-column">
          <input type="time" ng-model="options.expiration_time" ng-change="calcExpiration()">
        </div>
      </div>
      <div class="fill-row">
        <div class="half-column">
          <label for="pollMaxVote">Maximum answers per vote:</label>
          <input type="number" id="pollMaxVote" min="1" max="{{poll.answers.length}}" value="1" ng-model="options.max_answers">
        </div>
        <div class="half-column">
          <label>Show poll results: </label>
          <div class="fill-row thin-underline"></div>
          <label for="displayAlways">
            <input type="radio" id="displayAlways" ng-model="options.display_mode" value="always">
            Always shown
          </label>
          <label for="displayVoted">
            <input type="radio" id="displayVoted" ng-model="options.display_mode" value="voted">
            After voting
          </label>
          <label for="displayExpired">
            <input type="radio" id="displayExpired" ng-model="options.display_mode" value="expired" ng-disabled="!options.expiration">
            After expiration
          </label>
        </div>
      </div>
      <div class="fill-row">
        <div class="half-column">
          <button class="fill-row" ng-click="switches.editPoll = false">Cancel</button>
        </div>
        <div class="half-column">
          <button class="fill-row" ng-disabled="!pollValid()" ng-click="saveOptions()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Poll Results -->
  <div class="poll-answer" ng-repeat="answer in poll.answers">
    <label>
      <input class="poll-select" type="checkbox" ng-click="toggleAnswer(answer.id)" ng-disabled="pollAnswers.length >= poll.max_answers && pollAnswers.indexOf(answer.id) === -1" ng-if="canVote()"/>
      <div class="poll-bar">
        <span class="poll-answer-title" ng-bind="answer.answer"></span>
        <span class="poll-answer-fill" ng-bind="'(' + answer.percentage + '%) ' + answer.votes + (answer.votes > 1 || answer.votes === 0 ? ' votes' : ' vote')" ng-if="showPollResults()"></span>
        <section ng-style="answer.style" ng-if="showPollResults()"></section>
      </div>
    </label>
  </div>
  <button ng-click="vote()" ng-disabled="pollAnswers.length === 0" ng-if="canVote()">Vote</button>
  <button ng-if="canRemoveVote()" ng-click="removeVote()">Remove Vote</button>
</div>
