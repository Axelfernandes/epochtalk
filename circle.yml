machine:
  node:
    version: 7
  environment:
    DATABASE_URL: postgres://localhost/epoch_test
    TEST_DATABASE_URL: postgres://localhost/epoch_test
deployment:
  apidoc:
    branch: api-doc-1
    commands: |
      # apt-get update \
      # && apt-get upgrade -y \
      # && apt-get install -y --no-install-recommends \
      # build-essential g++ python2.7 python2.7-dev unzip curl \
      # && rm -rf /var/lib/apt/lists/* \
      # && mkdir -p /tmp \
      # && cd /tmp \
      # && curl -O https://bootstrap.pypa.io/get-pip.py \
      # && python get-pip.py \
      # && pip install awscli \
      # && rm -f /tmp/get-pip.py
      wget https://github.com/epochtalk/api-to-html/archive/master.zip
      unzip master.zip # api-to-html-master/
      cd api-to-html-master
      npm install
      # set env for epochtalk path (unzipped dir)
      echo "EPOCHTALK_PATH=../" > .env
      node .
      # push to S3
      aws s3 cp api.html $S3_URI --region $S3_REGION
